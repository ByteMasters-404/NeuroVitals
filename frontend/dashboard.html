<script>
if (localStorage.getItem("isLoggedIn") !== "true") {
    window.location.href = "../authentication_page/code.html";
}
</script>
<!DOCTYPE html>

<html class="dark" lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>NeuroVitals-Dashboard</title>
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect" />
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
  <link
    href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&amp;family=Noto+Sans:wght@400;500;600;700&amp;display=swap"
    rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
    rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="https://unpkg.com/uplot@1.6.24/dist/uPlot.min.css">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script src="https://unpkg.com/uplot@1.6.24/dist/uPlot.iife.min.js"></script>
  <script src="https://unpkg.com/smoothie@1.35.0/smoothie.js"></script>

  <!-- Theme Configuration -->
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#1625f3",
            "accent-cyan": "#00f0ff",
            "accent-purple": "#bf00ff",
            "background-light": "#f5f6f8",
            "background-dark": "#101223", // Matching the provided component bg
            "card-dark": "#181a34", // Matching the provided card bg
            "nav-dark": "#222549", // Matching the provided nav bg
            "text-secondary": "#9094cb",
          },
          fontFamily: {
            "display": ["Space Grotesk", "sans-serif"],
            "body": ["Noto Sans", "sans-serif"],
          },
          borderRadius: { "DEFAULT": "0.5rem", "lg": "1rem", "xl": "1.5rem", "full": "9999px" },
        },
      },
    }
  </script>
  <style>
    /* Custom scrollbar for webkit */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #101223;
    }

    ::-webkit-scrollbar-thumb {
      background: #222549;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #3b407a;
    }

    .neon-text {
      text-shadow: 0 0 10px rgba(0, 240, 255, 0.5);
    }

    .digital-twin-image {
      height: auto;
      aspect-ratio: 4 / 3;
    }

    .digital-twin-card {
      height: auto !important;
      min-height: unset !important;
    }

    .chart-grid {
      background-image: linear-gradient(rgba(144, 148, 203, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(144, 148, 203, 0.1) 1px, transparent 1px);
      background-size: 20px 20px;
    }

    .motor-diagnostics {
      margin-top: 0;
      align-self: flex-start;
    }
  </style>
</head>

<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-white font-display overflow-hidden">
  <div class="flex h-screen w-full">
    <!-- Side Navigation -->
    <aside
      class="w-64 bg-background-dark border-r border-[#222549] flex flex-col justify-between p-4 hidden lg:flex shrink-0 z-20">
      <div class="flex flex-col gap-6">
        <!-- Branding -->
        <div class="flex flex-col px-2">
          <h1 class="text-white text-2xl font-bold leading-normal tracking-wide">NeuroVitals<span
              class="text-primary"></span></h1>
          <p class="text-text-secondary text-xs font-normal leading-normal tracking-wider">BCI CONTROL CENTER v2.4</p>
        </div>
        <!-- Nav Items -->
        <nav class="flex flex-col gap-2">
          <a class="sidebar-item flex items-center gap-3 px-3 py-3 rounded-xl bg-primary/20 border border-primary/30 text-white group transition-colors"
            href="#">
            <span class="material-symbols-outlined text-primary group-hover:text-white">dashboard</span>
            <p class="text-sm font-medium leading-normal">Dashboard</p>
          </a>
          <a class="sidebar-item flex items-center gap-3 px-3 py-3 rounded-xl hover:bg-[#222549] text-text-secondary hover:text-white transition-colors"
            href="report-and-history.html">
            <span class="material-symbols-outlined">ecg_heart</span>
            <p class="text-sm font-medium leading-normal">Patient Data</p>
          </a>
          <a class="sidebar-item flex items-center gap-3 px-3 py-3 rounded-xl hover:bg-[#222549] text-text-secondary hover:text-white transition-colors"
            href="#">
            <span class="material-symbols-outlined">precision_manufacturing</span>
            <p class="text-sm font-medium leading-normal">Device Control</p>
          </a>
          <a class="sidebar-item flex items-center gap-3 px-3 py-3 rounded-xl hover:bg-[#222549] text-text-secondary hover:text-white transition-colors"
            href="profile-page.html">
            <span class="material-symbols-outlined">person</span>
            <p class="text-sm font-medium leading-normal">Profile</p>
          </a>
        </nav>
      </div>
      <!-- Bottom Actions -->
      <div class="flex flex-col gap-2">
        <a class="sidebar-item flex items-center gap-3 px-3 py-3 rounded-xl hover:bg-[#222549] text-text-secondary hover:text-white transition-colors"
          href="index.html">
          <span class="material-symbols-outlined">logout</span>
          <p class="text-sm font-medium leading-normal">Logout</p>
        </a>
        <div class="px-3 py-3 rounded-xl bg-[#101223] mt-2">
          <div class="flex items-center gap-3">

            <div class="flex flex-col">

            </div>
          </div>
        </div>
      </div>
    </aside>
    <!-- Main Content -->
    <div class="flex-1 flex flex-col h-full overflow-hidden relative">
      <!-- Top Navigation Bar -->
      <header
        class="flex items-center justify-between whitespace-nowrap border-b border-solid border-[#222549] bg-background-dark/80 backdrop-blur-md px-6 py-4 sticky top-0 z-10">
        <div class="flex items-center gap-4 text-white">
          <div class="lg:hidden">
            <span class="material-symbols-outlined cursor-pointer">menu</span>
          </div>
          <div class="flex items-center gap-2">
            <div class="h-2 w-2 rounded-full bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]"></div>
            <h2 class="text-white text-base md:text-lg font-bold leading-tight tracking-tight">Patient: John Doe <span
                class="text-text-secondary font-normal mx-2">|</span> Status: Connected</h2>
          </div>
        </div>
        <div class="flex items-center gap-4 md:gap-6">
         
          <div class="bg-center bg-no-repeat bg-cover rounded-full h-9 w-9 border border-[#222549]"
            data-alt="Profile picture of a doctor"
            style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDuS4zsq_nEwz7TikfgsEMF9Sx_Z-grFTE_0qHm997Gj1FXP6qa0t-b76ZRM4Dj7BOQfTJMSuCfKWOFNLjgo3yMJ7Ktk7YpErbXsmUPwjsFeO8Q5Ez-4fcp078plpblb1sGHZvH7-rx79fygPHNUk36s0hvmBL-wI4W6LTG239zfNN9N_cFZH1sN8kxwrsCX3HMqaePAPNYt55tqqyMBdpXDFWU240poQWqiSCg2FpxmEAlmZr5hLPoYxL0fsVCEol8abamMF2BBhk-");'>
          </div>
        </div>
      </header>
      <!-- Scrollable Content Area -->
      <main id="main-content" class="flex-1 overflow-y-auto p-4 md:p-6 lg:p-8 h-full">
        <div class="max-w-[1400px] mx-auto flex flex-col gap-6">
          <!-- Headlines & Top Controls -->
          <div class="flex flex-col md:flex-row md:items-end justify-between gap-4">
            <div>
              <h2 class="text-white text-3xl font-bold leading-tight">Live Telemetry</h2>
              <p class="text-text-secondary text-sm mt-1">Real-time neural monitoring and prosthetic feedback loop.</p>
            </div>
            <div class="flex gap-3">
              <button
                class="flex items-center gap-2 px-4 py-2 bg-[#222549] rounded-lg text-sm font-medium text-white border border-transparent hover:border-primary/50 transition-colors">
                <span class="material-symbols-outlined text-[18px]">history</span>
                Replay Session
              </button>
              <button
                class="flex items-center gap-2 px-4 py-2 bg-primary rounded-lg text-sm font-medium text-white shadow-lg shadow-primary/20 hover:bg-primary/90 transition-colors">
                <span class="material-symbols-outlined text-[18px]">tune</span>
                Calibrate Sensors
              </button>
            </div>
          </div>
          <!-- Main Grid -->
          <div class="grid grid-cols-12 gap-6 h-full">
            <!-- 3D Prosthetic Twin (Left Col) -->
            <div class="col-span-12 lg:col-span-4 flex flex-col">
              <div
                class="bg-card-dark rounded-xl shadow-[0_0_15px_rgba(0,0,0,0.2)] overflow-hidden border border-[#222549] h- flex flex-col">
                <div class="p-4 border-b border-[#222549] flex justify-between items-center">
                  <h3 class="text-white font-bold text-lg flex items-center gap-2">
                    <span class="material-symbols-outlined text-primary">view_in_ar</span>
                    Digital Twin
                  </h3>
                  <span
                    class="px-2 py-0.5 rounded bg-green-500/10 text-green-400 text-xs font-mono uppercase border border-green-500/20">Synced</span>
                </div>
                <div class="relative flex-1 min-h-[300px] bg-gradient-to-b from-[#101223] to-[#181a34]">
                  <!-- Interactive Overlay Controls -->
                  <div class="absolute top-4 right-4 flex flex-col gap-2 z-10">
                    <button
                      class="w-8 h-8 rounded bg-[#222549]/80 backdrop-blur text-white flex items-center justify-center hover:bg-primary"><span
                        class="material-symbols-outlined text-sm">rotate_right</span></button>
                    <button
                      class="w-8 h-8 rounded bg-[#222549]/80 backdrop-blur text-white flex items-center justify-center hover:bg-primary"><span
                        class="material-symbols-outlined text-sm">zoom_in</span></button>
                    <button
                      class="w-8 h-8 rounded bg-[#222549]/80 backdrop-blur text-white flex items-center justify-center hover:bg-primary"><span
                        class="material-symbols-outlined text-sm">layers</span></button>
                  </div>
                  <!-- 3D Model Placeholder -->
                  <div
                    class="mx-auto bg-center bg-contain bg-no-repeat opacity-90 transition-opacity hover:opacity-100 cursor-move"
                    data-alt="Futuristic 3D wireframe render of a robotic arm with glowing joints" style='
    background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuBQQaV0DxvUVaSaLr19chj4jpN-Tla7Doho-bIZutUAcCHGS1nFE44SmrojjYKhRYYU-EOznmDnnVsNnC_yqk85SBTl3gsuXHDDpahslWA-WHRlPDs_qulaQA4wKBAdNeOTiAg9Fr_4WSaOGbo6gLEEh5raKyPl6rOFrDazwgWqHz7CG4Gl_i5C80Ru_P5ngMC2g8y5v560cQAZuyDyIvzEFjCsmjsUp6V3lbfWg7DPll331R9jCbDx-bpaq4JB_XsxhE_peKjvMTKn");
    width: 100%;
    max-width: 420px;
    aspect-ratio: 4 / 5;
    mask-image: linear-gradient(to bottom, black 80%, transparent 100%);
    -webkit-mask-image: linear-gradient(to bottom, black 80%, transparent 100%);
  '>
                  </div>
                  <!-- Overlay Info -->
                  <div class="absolute bottom-4 left-4 right-4 flex justify-between items-end">
                    <div class="bg-[#101223]/80 backdrop-blur px-3 py-2 rounded-lg border border-white/5">
                      <p class="text-text-secondary text-xs uppercase mb-1">Current Action</p>
                      <p class="text-white text-sm font-bold">Cylindrical Grasp</p>
                    </div>
                    <div class="bg-[#101223]/80 backdrop-blur px-3 py-2 rounded-lg border border-white/5 text-right">
                      <p class="text-text-secondary text-xs uppercase mb-1">Rotation</p>
                      <p class="text-accent-cyan text-sm font-mono">X: 45° Y: 12°</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- EEG & Analytics (Right Col) -->
            <div class="col-span-12 lg:col-span-7 flex flex-col gap-6 min-h-0">

              <!-- EEG Waveform -->
              <div
                class="bg-card-dark rounded-xl shadow-lg border border-[#222549] p-5 relative overflow-hidden group w-[750px] flex flex-col">


                <div class="flex justify-between items-start mb-4 relative z-10">
                  <div>
                    <h3 class="text-white font-bold text-lg flex items-center gap-2">
                      <span class="material-symbols-outlined text-accent-purple">show_chart</span>
                      EEG Stream
                    </h3>
                    <div class="relative h-[260px] w-[650px] chart-grid">
                      <div id="eegPlot" class="absolute inset-0 rounded-xl bg-[#0f1023]">
                      </div>
                    </div>



                    <div class="grid grid-cols-4 gap-4 mt-4">
                      <div class="text-center">
                        <p class="text-xs text-blue-400">ALPHA</p>
                        <p id="alphaVal" class="text-lg font-bold">0.0 uV</p>
                      </div>
                      <div class="text-center">
                        <p class="text-xs text-indigo-400">BETA</p>
                        <p id="betaVal" class="text-lg font-bold">0.0 uV</p>
                      </div>
                      <div class="text-center">
                        <p class="text-xs text-purple-400">THETA</p>
                        <p id="thetaVal" class="text-lg font-bold">0.0 uV</p>
                      </div>
                      <div class="text-center">
                        <p class="text-xs text-pink-400">DELTA</p>
                        <p id="deltaVal" class="text-lg font-bold">0.0 uV</p>
                      </div>
                    </div>


                    <p class="text-text-secondary text-xs mt-1 font-mono">Channel 4 (Motor Cortex) - 256Hz</p>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-accent-cyan animate-pulse"></span>
                    <span class="text-accent-cyan text-xs font-mono">LIVE</span>
                  </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 rounded-xl">
                  <!-- AI Confidence -->
                  <div
                    class="bg-card-dark rounded-xl border border-[#222549] p-4 flex flex-col items-center justify-center relative">
                    <h4 class="text-text-secondary text-xs uppercase font-bold absolute top-4 left-4">AI Confidence</h4>
                    <div class="relative w-24 h-24 mt-4">
                      <!-- Donut Chart -->
                      <svg class="w-full h-full transform -rotate-90" viewbox="0 0 36 36">
                        <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                          fill="none" stroke="#222549" stroke-width="4"></path>
                        <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                          fill="none" stroke="#1625f3" stroke-dasharray="98, 100" stroke-width="4"></path>
                      </svg>
                      <div class="absolute inset-0 flex flex-col items-center justify-center">
                        <span class="text-white text-xl font-bold">98%</span>
                      </div>
                    </div>
                    <p class="text-white text-xs mt-2 text-center">Grasp Intent Predicted</p>
                  </div>
                  <!-- Grip Force -->
                  <div class="bg-card-dark rounded-xl border border-[#222549] p-4 flex flex-col justify-between">
                    <div class="flex justify-between items-start">
                      <h4 class="text-text-secondary text-xs uppercase font-bold">Grip Force</h4>
                      <span class="material-symbols-outlined text-text-secondary text-sm">hand_bones</span>
                    </div>
                    <div class="flex items-end gap-2 my-2">
                      <span class="text-3xl font-bold text-white neon-text">42</span>
                      <span class="text-text-secondary text-sm mb-1">Newtons</span>
                    </div>
                    <!-- Sparkline -->
                    <div class="h-8 w-full flex items-end gap-1">
                      <div class="w-1 bg-primary/30 h-[40%] rounded-t-sm"></div>
                      <div class="w-1 bg-primary/40 h-[60%] rounded-t-sm"></div>
                      <div class="w-1 bg-primary/60 h-[50%] rounded-t-sm"></div>
                      <div class="w-1 bg-primary/50 h-[70%] rounded-t-sm"></div>
                      <div class="w-1 bg-primary h-[80%] rounded-t-sm"></div>
                      <div class="w-1 bg-primary/50 h-[60%] rounded-t-sm"></div>
                      <div class="w-1 bg-primary/30 h-[40%] rounded-t-sm"></div>
                    </div>
                  </div>
                  <!-- System Status -->
                  <div class="bg-card-dark rounded-xl border border-[#222549] p-4 flex flex-col justify-between">
                    <h4 class="text-text-secondary text-xs uppercase font-bold">System Health</h4>
                    <div class="flex flex-col gap-3 mt-2">
                      <div class="flex items-center gap-3">
                        <div class="p-1.5 rounded bg-primary/20 text-primary">
                          <span class="material-symbols-outlined text-sm block">battery_charging_full</span>
                        </div>
                        <div class="flex-1">
                          <div class="flex justify-between mb-1">
                            <span class="text-white text-xs">Battery</span>
                            <span class="text-white text-xs">84%</span>
                          </div>
                          <div class="h-1.5 w-full bg-[#101223] rounded-full overflow-hidden">
                            <div class="h-full bg-green-500 w-[84%]"></div>
                          </div>
                        </div>
                      </div>
                      <div class="flex items-center gap-3">
                        <div class="p-1.5 rounded bg-orange-500/20 text-orange-400">
                          <span class="material-symbols-outlined text-sm block">thermostat</span>
                        </div>
                        <div class="flex-1">
                          <div class="flex justify-between mb-1">
                            <span class="text-white text-xs">Temp</span>
                            <span class="text-white text-xs">34°C</span>
                          </div>
                          <div class="h-1.5 w-full bg-[#101223] rounded-full overflow-hidden">
                            <div class="h-full bg-orange-400 w-[40%]"></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Motor Diagnostics -->
              <div class="w-[750px] bg-card-dark border border-[#222549] rounded-xl overflow-hidden shadow-sm">
              <div class="px-6 py-4 border-b border-[#222549] flex justify-between items-center">
                <h3 class="text-white font-bold text-lg">Motor Diagnostics</h3>
                <button class="text-primary text-sm font-medium hover:underline">View Full Log</button>
              </div>
              <div class="overflow-x-auto">
                <table class="w-[800px] text-left border-collapse">
                  <thead>
                    <tr class="bg-[#101223]/50 text-text-secondary text-xs uppercase tracking-wider">
                      <th class="px-6 py-3 font-medium">Motor ID</th>
                      <th class="px-6 py-3 font-medium">Function</th>
                      <th class="px-6 py-3 font-medium">Status</th>
                      <th class="px-6 py-3 font-medium">Load</th>
                      <th class="px-6 py-3 font-medium">Efficiency</th>
                      <th class="px-6 py-3 font-medium text-right">Action</th>
                    </tr>
                  </thead>
                  <tbody class="text-sm text-gray-300 divide-y divide-[#222549]">
                    <tr class="hover:bg-[#222549]/30 transition-colors">
                      <td class="px-6 py-4 font-mono text-white">MTR-01</td>
                      <td class="px-6 py-4">Wrist Rotation</td>
                      <td class="px-6 py-4"><span
                          class="inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-500/10 text-green-400 border border-green-500/20">Optimal</span>
                      </td>
                      <td class="px-6 py-4">12%</td>
                      <td class="px-6 py-4">98.5%</td>
                      <td class="px-6 py-4 text-right">
                        <button class="text-text-secondary hover:text-white"><span
                            class="material-symbols-outlined text-[20px]">more_vert</span></button>
                      </td>
                    </tr>
                    <tr class="hover:bg-[#222549]/30 transition-colors">
                      <td class="px-6 py-4 font-mono text-white">MTR-02</td>
                      <td class="px-6 py-4">Finger Flexion (Index)</td>
                      <td class="px-6 py-4"><span
                          class="inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-500/10 text-green-400 border border-green-500/20">Optimal</span>
                      </td>
                      <td class="px-6 py-4">45%</td>
                      <td class="px-6 py-4">97.2%</td>
                      <td class="px-6 py-4 text-right">
                        <button class="text-text-secondary hover:text-white"><span
                            class="material-symbols-outlined text-[20px]">more_vert</span></button>
                      </td>
                    </tr>
                    <tr class="hover:bg-[#222549]/30 transition-colors">
                      <td class="px-6 py-4 font-mono text-white">MTR-03</td>
                      <td class="px-6 py-4">Thumb Opposition</td>
                      <td class="px-6 py-4"><span
                          class="inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-500/10 text-yellow-400 border border-yellow-500/20">Calibrating</span>
                      </td>
                      <td class="px-6 py-4">--</td>
                      <td class="px-6 py-4">--</td>
                      <td class="px-6 py-4 text-right">
                        <button class="text-text-secondary hover:text-white"><span
                            class="material-symbols-outlined text-[20px]">more_vert</span></button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
      </main>
    </div>
  </div>


  <script>
    (function(){
      // Simple SPA loader: intercept aside links and load pages into #main-content
      function fetchText(url){ return fetch(url, {cache: 'no-store'}).then(r=>{ if(!r.ok) throw new Error('Fetch failed'); return r.text(); }); }

      function runScripts(container){
        const scripts = container.querySelectorAll('script');
        scripts.forEach(s => {
          const ns = document.createElement('script');
          if(s.src){ ns.src = s.src; ns.async = false; }
          if(s.type) ns.type = s.type;
          if(s.textContent) ns.textContent = s.textContent;
          document.body.appendChild(ns);
          s.parentNode && s.parentNode.removeChild(s);
        });
      }

      function preserveAndReplace(newHtml){
        const currentMain = document.getElementById('main-content');
        if(!currentMain) return;
        const temp = document.createElement('div');
        temp.innerHTML = newHtml;

        // Preserve existing nodes by id (move them into the new content when ids match)
        const existingIds = Array.from(currentMain.querySelectorAll('[id]')).map(e=>e.id).filter(Boolean);
        existingIds.forEach(id => {
          try{
            const nodeInTemp = temp.querySelector('#' + CSS.escape(id));
            const existing = document.getElementById(id);
            if(nodeInTemp && existing){
              nodeInTemp.replaceWith(existing);
            }
          }catch(e){ /* ignore */ }
        });

        // Replace main content with new nodes
        currentMain.innerHTML = '';
        while(temp.firstChild) currentMain.appendChild(temp.firstChild);

        // Execute scripts found in the injected content
        runScripts(currentMain);
      }

      async function navigateTo(href, push=true){
        try{
          const text = await fetchText(href);
          const parser = new DOMParser();
          const doc = parser.parseFromString(text, 'text/html');
          const newMain = doc.querySelector('#main-content') || doc.querySelector('main');
          if(!newMain){ window.location.href = href; return; }
          preserveAndReplace(newMain.innerHTML);
          if(push) history.pushState({url: href}, '', href);
          highlightActive(href);
          window.scrollTo(0,0);
        }catch(err){
          console.error('SPA load failed, falling back to full navigation', err);
          window.location.href = href;
        }
      }

      function setupAsideLinks(){
        const links = document.querySelectorAll('aside a');
        links.forEach(a=>{
          a.addEventListener('click', function(e){
            const href = a.getAttribute('href');
            if(!href || href.startsWith('#') || href.startsWith('mailto:') || href.startsWith('tel:')) return;
            e.preventDefault();
            navigateTo(href, true);
          });
        });
      }

      function highlightActive(href){
        const links = document.querySelectorAll('aside a');
        links.forEach(a=>{
          a.classList.remove('active');
          const ah = a.getAttribute('href');
          if(!ah) return;
          const aName = ah.split('/').pop();
          const hName = href.split('/').pop();
          if(aName === hName) a.classList.add('active');
        });
      }

      window.addEventListener('popstate', function(){
        const url = location.pathname.split('/').pop() || 'code.html';
        navigateTo(url, false);
      });

      document.addEventListener('DOMContentLoaded', function(){
        setupAsideLinks();
        highlightActive(location.pathname.split('/').pop());

        // Allow internal links inside main-content to also use SPA navigation
        const main = document.getElementById('main-content');
        if(main){
          main.addEventListener('click', function(e){
            const a = e.target.closest('a');
            if(!a) return;
            const href = a.getAttribute('href');
            if(!href || href.startsWith('#') || href.startsWith('http')) return;
            e.preventDefault();
            navigateTo(href, true);
          });
        }
      });
    })();

    /* ================= CONFIG ================= */
    const SAMPLE_RATE = 256;
    const SAMPLE_INTERVAL = 1000 / SAMPLE_RATE;

    /* ================= EEG MODEL ================= */
    let idx = 0;
    function generateEEG() {
      // Simulate realistic EEG signal with multiple frequency bands
      const alpha = 50 * Math.sin(2 * Math.PI * 10 * idx / SAMPLE_RATE); // Alpha waves (8-12 Hz)
      const beta = 30 * Math.sin(2 * Math.PI * 20 * idx / SAMPLE_RATE); // Beta waves (13-30 Hz)
      const theta = 40 * Math.sin(2 * Math.PI * 6 * idx / SAMPLE_RATE); // Theta waves (4-8 Hz)
      const delta = 60 * Math.sin(2 * Math.PI * 2 * idx / SAMPLE_RATE); // Delta waves (0.5-4 Hz)

      // Add some noise and baseline
      const noise = (Math.random() - 0.5) * 10;
      const baseline = 950;

      // Combine all components
      return baseline + alpha + beta + theta + delta + noise;
    }

    /* ================= DOM ================= */
    const plotEl = document.getElementById("eegPlot");
    const alphaVal = document.getElementById("alphaVal");
    const betaVal = document.getElementById("betaVal");
    const thetaVal = document.getElementById("thetaVal");
    const deltaVal = document.getElementById("deltaVal");

    /* ================= INIT AFTER LAYOUT ================= */
    function initEEGPlot() {
      const rect = plotEl.getBoundingClientRect();
      if (rect.width === 0 || rect.height === 0) {
        // Retry after a short delay if layout not ready
        setTimeout(initEEGPlot, 100);
        return;
      }

      // Data arrays for uPlot (combined single channel)
      const data = [
        [], // time
        [], // combined channel
      ];

      // uPlot options
      const opts = {
        width: rect.width,
        height: rect.height,
        scales: {
          x: {
            time: false,
          },
          y: {
            range: [800, 1100],
          },
        },
        series: [
          {}, // time series
          {
            stroke: '#00f0ff',
            width: 2,
          },
        ],
        axes: [
          {
            show: false, // hide x axis
          },
          {
            stroke: 'rgba(144,148,203,0.08)',
            grid: {
              stroke: 'rgba(144,148,203,0.08)',
              width: 1,
            },
          },
        ],
      };

      // Create uPlot chart
      const u = new uPlot(opts, data, plotEl);

      /* ================= REAL-TIME SAMPLING ================= */
      setInterval(() => {
        const v1 = generateEEG();
        const v2 = generateEEG() + 50; // Offset for second channel
        const v3 = generateEEG() - 50; // Offset for third channel

        // Combine 3 channels into one by averaging
        const combined = (v1 + v2 + v3) / 3;

        const t = idx * SAMPLE_INTERVAL; // Use sample index for steady time

        // Append data
        data[0].push(t);
        data[1].push(combined);

        // Keep only last 1000 points for scrolling effect
        if (data[0].length > 1000) {
          data[0].shift();
          data[1].shift();
        }

        // Update chart
        u.setData(data);

        alphaVal.textContent = Math.abs(v1).toFixed(1) + " uV";
        betaVal.textContent = Math.abs(v2).toFixed(1) + " uV";
        thetaVal.textContent = Math.abs(v3).toFixed(1) + " uV";
        deltaVal.textContent = Math.abs(combined).toFixed(1) + " uV";

        idx++;
      }, SAMPLE_INTERVAL);
    }

    // Start initialization after layout is likely stable
    setTimeout(initEEGPlot, 500);
  </script>

</body>

</html>
